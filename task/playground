#! /bin/sh

# shellcheck disable=SC2034
THIS_SCRIPT_DESC="Start tree-sitter playground"

THIS_SCRIPT=$(readlink -f "$0")
THIS_SCRIPT_DIR=$(dirname "$THIS_SCRIPT")

# shellcheck source=.common
. "${THIS_SCRIPT_DIR}/.common"

########################################################################

# this is here because it seems that to stop tree-sitter playground a
# user is likely to press control-c.  resuming after doesn't appear to
# happen otherwise.  that might lead to an incorrect current working
# directory.

trap cleanup INT

cleanup () {
  printf "\nLikely trapped Control-C\n"
}

########################################################################

cur_dir=$(pwd)

cd "${PARSER_PROJ_DIR}" || exit 1

parser_wasm=$("${ATSP_UTIL}"/wasm-name)
parser_wasm_path=${PARSER_PROJ_DIR}/${parser_wasm}

if [ -f "${parser_wasm_path}" ]; then
  printf "Found %s, starting playground.\n" "${parser_wasm}"
else
  printf "Failed to find %s...exiting\n" "${parser_wasm}"
  exit 1;
fi

printf "* Invoking tree-sitter playground subcommand\n"

${ATSP_TS_PATH} playground

cd "${cur_dir}" || exit 1

printf "Done\n"
